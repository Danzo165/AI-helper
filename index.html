<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–ò –ø–æ–º–æ—à–Ω–∏–∫</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: #f0f2f5;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1a73e8;
            text-align: center;
        }
        .key-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #e8f0fe;
            border-radius: 8px;
        }
        .key-section input {
            width: 60%;
            padding: 10px;
            border: 1px solid #dadce0;
            border-radius: 5px;
            margin-right: 10px;
        }
        .key-section button {
            padding: 10px 20px;
            background: #1a73e8;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .key-section button:hover {
            background: #1557b0;
        }
        .api-link {
            display: inline-block;
            margin-left: 10px;
            padding: 8px 15px;
            background: #34a853;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-size: 13px;
        }
        .api-link:hover {
            background: #2d8e46;
        }
        .info-box {
            margin-top: 10px;
            padding: 10px;
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 5px;
            font-size: 13px;
        }
        .info-box a {
            color: #1a73e8;
            text-decoration: none;
            font-weight: bold;
        }
        .info-box a:hover {
            text-decoration: underline;
        }
        .model-section {
            margin-bottom: 20px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        select {
            padding: 8px;
            width: 100%;
            border: 1px solid #dadce0;
            border-radius: 5px;
            font-size: 14px;
        }
        .chat-box {
            height: 400px;
            overflow-y: auto;
            border: 1px solid #dadce0;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            background: #fafafa;
        }
        .message {
            margin-bottom: 15px;
            display: flex;
        }
        .user-message {
            justify-content: flex-end;
        }
        .bot-message {
            justify-content: flex-start;
        }
        .message-text {
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
        }
        .user-message .message-text {
            background: #1a73e8;
            color: white;
        }
        .bot-message .message-text {
            background: white;
            color: #202124;
            border: 1px solid #dadce0;
        }
        .input-area {
            display: flex;
            gap: 10px;
        }
        .input-area input {
            flex: 1;
            padding: 12px;
            border: 1px solid #dadce0;
            border-radius: 5px;
            font-size: 14px;
        }
        .input-area button {
            padding: 12px 30px;
            background: #1a73e8;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .input-area button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .status {
            margin-top: 10px;
            padding: 8px;
            text-align: center;
            color: #5f6368;
            font-size: 13px;
        }
        .footer {
            margin-top: 20px;
            text-align: center;
            font-size: 12px;
            color: #5f6368;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ –ò–ò –ø–æ–º–æ—à–Ω–∏–∫</h1>
        
        <div class="key-section">
            <input type="password" id="apiKey" placeholder="–í–≤–µ–¥–∏ API –∫–ª—é—á Gemini">
            <button onclick="saveKey()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <a href="https://aistudio.google.com/app/apikey" target="_blank" class="api-link">üîë –ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á</a>
            
            <div class="info-box">
                <strong>üìå –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –∫–ª—é—á:</strong>
                <ol style="margin-top: 5px; margin-left: 20px;">
                    <li>–ü–µ—Ä–µ–π–¥–∏ –Ω–∞ —Å–∞–π—Ç <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a></li>
                    <li>–ù–∞–∂–º–∏ "Create API Key" (–°–æ–∑–¥–∞—Ç—å API –∫–ª—é—á)</li>
                    <li>–°–∫–æ–ø–∏—Ä—É–π –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –∫–ª—é—á</li>
                    <li>–í—Å—Ç–∞–≤—å –µ–≥–æ –≤ –ø–æ–ª–µ –≤—ã—à–µ –∏ –Ω–∞–∂–º–∏ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"</li>
                </ol>
                <p style="margin-top: 5px; color: #856404;">‚ö†Ô∏è –ö–ª—é—á —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Ç–≤–æ–µ–º –±—Ä–∞—É–∑–µ—Ä–µ –∏ –Ω–∏–∫—É–¥–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è!</p>
            </div>
        </div>

        <div class="model-section">
            <select id="modelSelect">
                <option value="">-- –í—ã–±–µ—Ä–∏ –º–æ–¥–µ–ª—å --</option>
            </select>
            <div id="modelStatus" style="font-size: 12px; margin-top: 5px; color: #5f6368;"></div>
        </div>
        
        <div class="chat-box" id="chatBox">
            <div class="message bot-message">
                <div class="message-text">
                    üëã –ü—Ä–∏–≤–µ—Ç! –Ø —Ç–≤–æ–π –ò–ò –ø–æ–º–æ—à–Ω–∏–∫.<br><br>
                    <strong>–ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å:</strong><br>
                    1Ô∏è‚É£ –ü–æ–ª—É—á–∏ API –∫–ª—é—á (–∫–Ω–æ–ø–∫–∞ "–ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á" –≤—ã—à–µ)<br>
                    2Ô∏è‚É£ –í—Å—Ç–∞–≤—å –∫–ª—é—á –∏ –Ω–∞–∂–º–∏ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"<br>
                    3Ô∏è‚É£ –ù–∞–∂–º–∏ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–¥–µ–ª–∏"<br>
                    4Ô∏è‚É£ –í—ã–±–µ—Ä–∏ –º–æ–¥–µ–ª—å –∏–∑ —Å–ø–∏—Å–∫–∞<br>
                    5Ô∏è‚É£ –ó–∞–¥–∞–≤–∞–π –≤–æ–ø—Ä–æ—Å—ã!
                </div>
            </div>
        </div>
        
        <div class="input-area">
            <input type="text" id="userInput" placeholder="–°–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω–∏ –∫–ª—é—á –∏ –≤—ã–±–µ—Ä–∏ –º–æ–¥–µ–ª—å..." disabled>
            <button onclick="sendMessage()" id="sendBtn" disabled>–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
        
        <div class="status" id="status"></div>
        
        <div class="footer">
            üîê –ö–ª—é—á —Ö—Ä–∞–Ω–∏—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ ‚Ä¢ 
            <a href="https://aistudio.google.com/app/apikey" target="_blank" style="color: #1a73e8;">–ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á</a> ‚Ä¢ 
            v1.0
        </div>
    </div>

    <script>
        const API_URL = 'https://generativelanguage.googleapis.com/v1beta/';
        let apiKey = localStorage.getItem('gemini_key') || '';
        let currentModel = '';
        
        const chatBox = document.getElementById('chatBox');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const apiKeyInput = document.getElementById('apiKey');
        const modelSelect = document.getElementById('modelSelect');
        const statusDiv = document.getElementById('status');
        const modelStatus = document.getElementById('modelStatus');
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –∫–ª—é—á
        if (apiKey) {
            apiKeyInput.value = apiKey;
            statusDiv.textContent = '‚úÖ –ö–ª—é—á –∑–∞–≥—Ä—É–∂–µ–Ω';
            loadModels();
        }
        
        function saveKey() {
            const key = apiKeyInput.value.trim();
            if (key) {
                apiKey = key;
                localStorage.setItem('gemini_key', key);
                statusDiv.textContent = '‚úÖ –ö–ª—é—á —Å–æ—Ö—Ä–∞–Ω–µ–Ω';
                loadModels();
                addBotMessage('‚úÖ –ö–ª—é—á —Å–æ—Ö—Ä–∞–Ω–µ–Ω! –°–µ–π—á–∞—Å –ø—Ä–æ–≤–µ—Ä—é –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏...');
            } else {
                statusDiv.textContent = '‚ùå –í–≤–µ–¥–∏ –∫–ª—é—á';
            }
        }
        
        async function testModels() {
            if (!apiKey) {
                statusDiv.textContent = '‚ùå –°–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω–∏ –∫–ª—é—á';
                return;
            }
            
            modelStatus.textContent = '‚è≥ –ü—Ä–æ–≤–µ—Ä—è—é –º–æ–¥–µ–ª–∏...';
            statusDiv.textContent = '‚è≥ –ó–∞–≥—Ä—É–∂–∞—é —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π...';
            
            try {
                const response = await fetch(`${API_URL}models?key=${apiKey}`);
                const data = await response.json();
                
                if (data.models) {
                    // –û—á–∏—â–∞–µ–º select
                    modelSelect.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏ –º–æ–¥–µ–ª—å --</option>';
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏
                    data.models.forEach(model => {
                        if (model.name.includes('gemini') && model.supportedGenerationMethods?.includes('generateContent')) {
                            const option = document.createElement('option');
                            option.value = model.name;
                            // –ö—Ä–∞—Å–∏–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
                            let displayName = model.name.replace('models/', '');
                            option.textContent = `${displayName} ‚úÖ`;
                            modelSelect.appendChild(option);
                        }
                    });
                    
                    modelStatus.textContent = `‚úÖ –ù–∞–π–¥–µ–Ω–æ ${modelSelect.options.length - 1} –º–æ–¥–µ–ª–µ–π`;
                    statusDiv.textContent = '‚úÖ –ú–æ–¥–µ–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã, –≤—ã–±–µ—Ä–∏ –æ–¥–Ω—É';
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤ —á–∞—Ç–µ
                    let modelsList = 'üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏:\n';
                    for (let i = 1; i < modelSelect.options.length; i++) {
                        modelsList += `‚Ä¢ ${modelSelect.options[i].textContent}\n`;
                    }
                    addBotMessage(modelsList);
                } else {
                    throw new Error('–ù–µ—Ç –º–æ–¥–µ–ª–µ–π –≤ –æ—Ç–≤–µ—Ç–µ');
                }
            } catch (error) {
                modelStatus.textContent = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
                statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞: ' + error.message;
                addBotMessage('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª–∏. –ü—Ä–æ–≤–µ—Ä—å –∫–ª—é—á.');
            }
        }
        
        async function loadModels() {
            await testModels();
        }
        
        // –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏
        modelSelect.addEventListener('change', function() {
            if (this.value) {
                currentModel = this.value;
                userInput.disabled = false;
                sendBtn.disabled = false;
                userInput.placeholder = "–ù–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ...";
                modelStatus.textContent = `‚úÖ –í—ã–±—Ä–∞–Ω–∞: ${this.value}`;
                addBotMessage(`‚úÖ –ú–æ–¥–µ–ª—å –≤—ã–±—Ä–∞–Ω–∞: ${this.value}\n–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã!`);
                userInput.focus();
            } else {
                userInput.disabled = true;
                sendBtn.disabled = true;
                userInput.placeholder = "–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏ –º–æ–¥–µ–ª—å...";
            }
        });
        
        function addBotMessage(text) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot-message';
            messageDiv.innerHTML = `<div class="message-text">${text.replace(/\n/g, '<br>')}</div>`;
            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }
        
        function addUserMessage(text) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user-message';
            messageDiv.innerHTML = `<div class="message-text">${text}</div>`;
            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }
        
        async function sendMessage() {
            const message = userInput.value.trim();
            
            if (!message) return;
            if (!apiKey) {
                statusDiv.textContent = '‚ùå –ù–µ—Ç –∫–ª—é—á–∞';
                return;
            }
            if (!currentModel) {
                statusDiv.textContent = '‚ùå –í—ã–±–µ—Ä–∏ –º–æ–¥–µ–ª—å';
                return;
            }
            
            addUserMessage(message);
            userInput.value = '';
            
            statusDiv.textContent = 'ü§î –î—É–º–∞—é...';
            sendBtn.disabled = true;
            
            try {
                const response = await fetch(`${API_URL}${currentModel}:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: message
                            }]
                        }]
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || '–û—à–∏–±–∫–∞');
                }
                
                const data = await response.json();
                const answer = data.candidates[0].content.parts[0].text;
                
                addBotMessage(answer);
                statusDiv.textContent = '‚úÖ –ì–æ—Ç–æ–≤–æ';
            } catch (error) {
                statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞';
                addBotMessage('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            } finally {
                sendBtn.disabled = false;
                userInput.focus();
            }
        }
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ Enter
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !sendBtn.disabled) {
                sendMessage();
            }
        });
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        window.saveKey = saveKey;
        window.sendMessage = sendMessage;
        window.testModels = testModels;
    </script>
</body>
</html>